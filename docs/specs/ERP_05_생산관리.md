# ERP 생산관리 모듈 기능정의서

## 1. 모듈 개요

| 항목 | 내용 |
|------|------|
| 모듈 ID | ERP-PP |
| 모듈명 | 생산관리 (Production Planning) |
| 화면 수 | 8개 |
| 목적 | 생산계획 수립, MRP 전개, 제조오더 관리 및 실적 집계 |
| 대상 사용자 | 생산관리팀, 자재팀, 제조팀 |
| 핵심 기능 | MPS, MRP, 제조오더, 생산실적 집계 |

## 2. 화면 목록

| 화면 ID | 화면명 | 우선순위 | 설명 |
|---------|--------|----------|------|
| ERP-PP-001 | MPS (주생산계획) | P1 | 월간/주간 생산계획 수립 |
| ERP-PP-002 | MRP (자재소요계획) | P1 | 자재 소요량 계산 및 발주 계획 |
| ERP-PP-003 | 제조오더 관리 | P1 | 제조오더 생성/발행/관리 |
| ERP-PP-004 | 제조오더 현황 | P1 | 제조오더 진행 상태 모니터링 |
| ERP-PP-005 | 생산실적 조회 | P1 | 생산실적 집계/분석 |
| ERP-PP-006 | 작업지시 관리 | P1 | MES 연동 작업지시 관리 |
| ERP-PP-007 | 생산능력 분석 | P2 | 설비/라인 생산능력 분석 |
| ERP-PP-008 | 생산 KPI | P2 | 생산성 지표 대시보드 |

---

## 3. 화면별 상세 정의

### 3.1 ERP-PP-001: MPS (주생산계획)

#### 3.1.1 화면 목적
- 수주 및 수요예측 기반 월간/주간 생산계획 수립

#### 3.1.2 화면 레이아웃
```
┌─────────────────────────────────────────────────────────────────┐
│ MPS (주생산계획)                         [신규] [저장] [확정] [MRP]│
├─────────────────────────────────────────────────────────────────┤
│ ┌─ 검색조건 ─────────────────────────────────────────────────┐ │
│ │ 계획년월: [2024-02 ▼]  공장: [본사공장  ▼]                  │ │
│ │ 제품군: [전체      ▼]  상태: [전체    ▼]           [검색]  │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 생산계획 요약 ───────────────────────────────────────────┐ │
│ │ 계획수량: 125,000 EA  │  계획금액: 1,875,000,000원         │ │
│ │ 제품수: 15종         │  가동일수: 22일                     │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ MPS 계획표 ──────────────────────────────────────────────┐ │
│ │ 제품코드  │제품명      │1주    │2주    │3주    │4주    │합계   │ │
│ │──────────┼───────────┼──────┼──────┼──────┼──────┼──────│ │
│ │ PCB-MB-001│스마트폰메인 │15,000│15,000│20,000│15,000│65,000│ │
│ │ PCB-PW-001│전원보드    │8,000 │8,000 │10,000│9,000 │35,000│ │
│ │ PCB-LED-01│LED드라이버 │5,000 │5,000 │5,000 │5,000 │20,000│ │
│ │ ECU-001   │차량ECU     │1,000 │1,500 │1,500 │1,000 │5,000 │ │
│ │──────────┴───────────┴──────┴──────┴──────┴──────┴──────│ │
│ │ 합계                   │29,000│29,500│36,500│30,000│125,000│ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 수요-계획 비교 ──────────────────────────────────────────┐ │
│ │ 구분       │1주    │2주    │3주    │4주    │합계    │       │ │
│ │───────────┼──────┼──────┼──────┼──────┼───────│       │ │
│ │ 수주잔량   │25,000│28,000│35,000│27,000│115,000│       │ │
│ │ 재고       │12,000│ -    │ -    │ -    │12,000 │       │ │
│ │ 생산계획   │29,000│29,500│36,500│30,000│125,000│       │ │
│ │ 예상재고   │16,000│17,500│19,000│22,000│22,000 │       │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 생산능력 검토 ───────────────────────────────────────────┐ │
│ │ 라인    │능력/일│가동일│총능력 │계획량 │가동률│상태       │ │
│ │────────┼──────┼─────┼──────┼──────┼─────┼──────────│ │
│ │ SMT-L01 │5,000 │22   │110,000│95,000 │86%  │정상       │ │
│ │ SMT-L02 │3,000 │22   │66,000 │45,000 │68%  │여유       │ │
│ │ ASSY-L01│2,000 │22   │44,000 │25,000 │57%  │여유       │ │
│ └───────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

#### 3.1.3 데이터 항목

**MPS 헤더 (erp_mps_header)**

| 필드명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| mps_no | VARCHAR(12) | Y | MPS번호 (MPS+년월+일련번호) |
| plan_year | INT | Y | 계획년도 |
| plan_month | INT | Y | 계획월 |
| plant_code | VARCHAR(10) | Y | 공장코드 |
| status | VARCHAR(10) | Y | 상태 (작성/확정/MRP완료) |
| total_qty | INT | N | 총 계획수량 |
| working_days | INT | N | 가동일수 |

**MPS 상세 (erp_mps_detail)**

| 필드명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| mps_no | VARCHAR(12) | Y | MPS번호 |
| item_code | VARCHAR(20) | Y | 제품코드 |
| week_no | INT | Y | 주차 (1-5) |
| plan_qty | INT | Y | 계획수량 |
| demand_qty | INT | N | 수요량 (수주+예측) |
| stock_qty | INT | N | 기초재고 |

#### 3.1.4 비즈니스 로직
```
1. 수요 집계
   - 수주잔량 + 안전재고 목표 - 현재고
   - 주간 단위로 분배
   - 수요예측 데이터 반영 (선택)

2. 생산능력 검토
   - 라인별 일일 생산능력 × 가동일수
   - 능력 초과 시 경고 표시
   - 대안 제시 (라인 이동, 외주 등)

3. MPS 확정
   - 확정 시 변경 불가 (변경은 별도 화면)
   - MRP 전개 대상으로 설정
   - 제조오더 생성 기반 데이터

4. 이월 처리
   - 전월 미달성 수량 자동 이월
   - 기초재고 반영
```

---

### 3.2 ERP-PP-002: MRP (자재소요계획)

#### 3.2.1 화면 목적
- MPS 기반 자재 소요량 계산 및 발주 계획 수립

#### 3.2.2 화면 레이아웃
```
┌─────────────────────────────────────────────────────────────────┐
│ MRP (자재소요계획)                       [MRP실행] [결과조회] [발주]│
├─────────────────────────────────────────────────────────────────┤
│ ┌─ MRP 실행조건 ─────────────────────────────────────────────┐ │
│ │ MPS번호: [MPS202402  🔍]  계획기간: 2024-02               │ │
│ │ 실행유형: [○전체재생성 ●순변경(Net Change)]               │ │
│ │ 안전재고 고려: [▣]  발주중 수량 반영: [▣]       [MRP실행]  │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ MRP 실행결과 요약 ───────────────────────────────────────┐ │
│ │ 실행일시: 2024-01-25 14:30:25                              │ │
│ │ 소요품목: 1,256개  │  부족품목: 45개  │  발주권고: 38개    │ │
│ │ 소요금액: 856,000,000원  │  발주권고금액: 125,000,000원    │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 자재소요 상세 ───────────────────────────────────────────┐ │
│ │ 품목코드   │품명        │총소요│현재고│발주중│부족│발주권고│ │
│ │───────────┼───────────┼─────┼─────┼─────┼───┼──────│ │
│ │ RES-0402-10│칩저항 10KΩ│800K │130K │200K │470K│500K   │ │
│ │ CAP-0603-10│MLCC 10uF  │500K │20K  │100K │380K│400K   │ │
│ │ IC-MCU-32  │MCU STM32  │65K  │300  │0    │64.7K│70K    │ │
│ │ IC-MEM-128 │메모리128M │65K  │5K   │30K  │30K │35K    │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 품목별 소요 전개 (RES-0402-10K) ─────────────────────────┐ │
│ │ 상위품목   │BOM수량│생산계획│소요량  │소요일  │           │ │
│ │───────────┼──────┼──────┼───────┼───────┤           │ │
│ │ PCB-MB-001│×12   │65,000│780,000│1주차  │           │ │
│ │ PCB-PW-001│×8    │35,000│280,000│1-4주차│           │ │
│ │ 기타       │      │      │40,000 │       │           │ │
│ │───────────┴──────┴──────┴───────┴───────┤           │ │
│ │                         총소요: 1,100,000│           │ │
│ │                         현재고: 130,000  │           │ │
│ │                         발주중: 200,000  │           │ │
│ │                         순소요: 770,000  │           │ │
│ │                                                       │ │
│ │ 공급업체: 삼성전기  │  리드타임: 7일  │  MOQ: 50,000  │ │
│ │ 발주권고: 800,000 (MOQ 단위 절상)                       │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 발주 계획 ───────────────────────────────────────────────┐ │
│ │ [▣] 선택품목 구매요청 생성                                │ │
│ │ 발주 예정일: [2024-01-26]  납기: [2024-02-02]             │ │
│ │                                      [선택품목 발주생성]   │ │
│ └───────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

#### 3.2.3 데이터 항목

**MRP 결과 (erp_mrp_result)**

| 필드명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| mrp_run_id | VARCHAR(20) | Y | MRP 실행 ID |
| run_date | TIMESTAMP | Y | 실행일시 |
| mps_no | VARCHAR(12) | Y | 참조 MPS번호 |
| item_code | VARCHAR(20) | Y | 품목코드 |
| gross_req | INT | Y | 총소요량 |
| on_hand | INT | Y | 현재고 |
| on_order | INT | Y | 발주중 수량 |
| net_req | INT | Y | 순소요량 |
| planned_order | INT | Y | 계획발주량 |
| order_date | DATE | N | 발주예정일 |
| due_date | DATE | N | 필요일자 |

#### 3.2.4 비즈니스 로직
```
1. MRP 전개 (BOM Explosion)
   - MPS 품목의 BOM 전개
   - Level별 순차 계산 (Level 0 → N)
   - 공용부품 소요 합산

2. 순소요량 계산
   순소요 = 총소요 - 현재고 - 발주중 - 안전재고

3. 계획발주량 결정
   - MOQ (최소발주단위) 반영
   - 발주배수 (Order Multiple) 반영
   - 리드타임 역산하여 발주일 결정

4. 발주 생성
   - 선택 품목 구매요청 자동 생성
   - 공급업체별 그룹핑 (선택)
```

---

### 3.3 ERP-PP-003: 제조오더 관리

#### 3.3.1 화면 목적
- 제조오더 생성, 발행, 관리

#### 3.3.2 화면 레이아웃
```
┌─────────────────────────────────────────────────────────────────┐
│ 제조오더 관리                          [신규] [저장] [발행] [취소]│
├─────────────────────────────────────────────────────────────────┤
│ ┌─ 검색조건 ─────────────────────────────────────────────────┐ │
│ │ 제조일자: [2024-02-01] ~ [2024-02-29]  상태: [전체    ▼]  │ │
│ │ 제품: [               ]  오더번호: [            ]  [검색]  │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 제조오더 목록 ───────────────────────────────────────────┐ │
│ │ 오더번호    │제조일자│제품        │계획량│완료량│상태  │라인 │ │
│ │─────────────┼───────┼───────────┼─────┼─────┼─────┼────│ │
│ │ MO24020001  │02-05  │PCB-MB-001 │5,000│5,000│완료  │L01 │ │
│ │ MO24020002  │02-06  │PCB-MB-001 │5,000│3,200│진행중│L01 │ │
│ │ MO24020003  │02-07  │PCB-PW-001 │3,000│0    │발행  │L02 │ │
│ │ MO24020004  │02-08  │PCB-LED-01 │2,000│0    │작성  │L02 │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 제조오더 상세 ───────────────────────────────────────────┐ │
│ │ 오더번호: [MO24020002   ]  상태: [진행중]                   │ │
│ │ 제품: [PCB-MB-001     ]  제품명: [스마트폰 메인보드]       │ │
│ │ 계획수량: [5,000       ]  완료수량: [3,200]  양품률: 98.2% │ │
│ │                                                             │ │
│ │ 제조일자: [2024-02-06   ]  납기: [2024-02-08]              │ │
│ │ 공장: [본사공장      ▼]  라인: [SMT-L01     ▼]            │ │
│ │ MPS참조: [MPS202402    ]  수주참조: [SO24010001]           │ │
│ │                                                             │ │
│ │ ┌─ BOM 자재 ─────────────────────────────────────────────┐│ │
│ │ │ 품목코드    │품명        │단위소요│총소요│출고량│상태   ││ │
│ │ │────────────┼───────────┼──────┼─────┼─────┼─────││ │
│ │ │ RES-0402-10K│칩저항 10KΩ│12    │60,000│60,000│완료  ││ │
│ │ │ CAP-0603-10U│MLCC 10uF  │8     │40,000│40,000│완료  ││ │
│ │ │ IC-MCU-32   │MCU STM32  │1     │5,000 │5,000 │완료  ││ │
│ │ │ PCB-RAW-001 │PCB원판    │1     │5,000 │5,000 │완료  ││ │
│ │ └─────────────────────────────────────────────────────────┘│ │
│ │                                                             │ │
│ │ ┌─ 공정 Routing ─────────────────────────────────────────┐│ │
│ │ │ 공정순서│공정명  │설비      │표준시간│실적시간│상태   ││ │
│ │ │────────┼───────┼─────────┼───────┼──────┼─────││ │
│ │ │ 10     │Printing│PRINTER-01│15분   │14분   │완료  ││ │
│ │ │ 20     │SPI검사 │SPI-01    │5분    │5분    │완료  ││ │
│ │ │ 30     │Mounting│MOUNTER-01│45분   │43분   │진행중││ │
│ │ │ 40     │Reflow │REFLOW-01 │20분   │-      │대기  ││ │
│ │ │ 50     │AOI검사 │AOI-01    │10분   │-      │대기  ││ │
│ │ └─────────────────────────────────────────────────────────┘│ │
│ └───────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

#### 3.3.3 데이터 항목

**제조오더 (erp_manufacturing_order)**

| 필드명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| mo_no | VARCHAR(12) | Y | 제조오더번호 (MO+년월+일련번호) |
| item_code | VARCHAR(20) | Y | 제품코드 |
| plan_qty | INT | Y | 계획수량 |
| good_qty | INT | N | 양품수량 |
| defect_qty | INT | N | 불량수량 |
| plan_date | DATE | Y | 제조일자 |
| due_date | DATE | Y | 납기일자 |
| plant_code | VARCHAR(10) | Y | 공장코드 |
| line_code | VARCHAR(10) | Y | 라인코드 |
| status | VARCHAR(10) | Y | 상태 (작성/발행/진행중/완료/취소) |
| mps_no | VARCHAR(12) | N | 참조 MPS번호 |
| so_no | VARCHAR(12) | N | 참조 수주번호 |
| bom_version | VARCHAR(10) | N | BOM 버전 |
| routing_version | VARCHAR(10) | N | Routing 버전 |

#### 3.3.4 비즈니스 로직
```
1. 제조오더 생성
   - MPS 기반 자동 생성 또는 수동 생성
   - BOM 전개하여 자재 소요 계산
   - Routing 복사하여 공정 정보 생성

2. 제조오더 발행
   - 자재 가용성 검증
   - 생산능력 검증
   - MES 작업지시 자동 생성

3. 자재 출고
   - 발행 시 자재 예약
   - 라인투입 시 재고 차감
   - 잔여 자재 반품 처리

4. 완료 처리
   - 양품/불량 실적 집계
   - 완제품 입고 처리
   - 원가 계산 기초 데이터
```

---

### 3.4 ERP-PP-004: 제조오더 현황

#### 3.4.1 화면 목적
- 제조오더 진행 상태 모니터링

#### 3.4.2 화면 레이아웃
```
┌─────────────────────────────────────────────────────────────────┐
│ 제조오더 현황                                    [새로고침] [엑셀]│
├─────────────────────────────────────────────────────────────────┤
│ ┌─ 검색조건 ─────────────────────────────────────────────────┐ │
│ │ 제조일자: [2024-02-01] ~ [2024-02-29]                       │ │
│ │ 상태: [▣전체 ☑발행 ☑진행중 □완료 □취소]                    │ │
│ │ 라인: [전체      ▼]  제품: [              ]        [검색]   │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 현황 요약 ───────────────────────────────────────────────┐ │
│ │ 총 오더: 156건  │  발행: 25건  │  진행중: 15건  │  완료: 116건│ │
│ │ 계획량: 650,000 │  완료량: 485,000 (74.6%)                  │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 제조오더 현황 ───────────────────────────────────────────┐ │
│ │ 오더번호  │제품      │라인 │계획│완료│진행률│양품률│납기│D-Day│상태│ │
│ │──────────┼─────────┼────┼───┼───┼────┼────┼───┼────┼──│ │
│ │MO24020002│PCB-MB-001│L01 │5K │3.2K│64% │98.2%│02-08│D-2│🟡│ │
│ │MO24020003│PCB-PW-001│L02 │3K │0  │0%  │-   │02-07│D-1│🔴│ │
│ │MO24020005│ECU-001   │L03 │1K │1K │100%│97.5%│02-06│완료│🟢│ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 라인별 진행현황 (간트차트) ──────────────────────────────┐ │
│ │          │06일   │07일   │08일   │09일   │10일   │       │ │
│ │──────────┼──────┼──────┼──────┼──────┼──────┤       │ │
│ │ SMT-L01  │▓▓▓▓▓▓│▓▓▓▓▓▓│░░░░░░│      │      │ MO002 │ │
│ │ SMT-L02  │      │▓▓▓▓▓▓│▓▓▓▓▓▓│▓▓▓░░░│      │ MO003 │ │
│ │ ASSY-L01 │▓▓▓▓▓▓│░░░░░░│      │      │      │ MO004 │ │
│ │ THT-L01  │      │▓▓▓▓▓▓│▓▓▓▓▓▓│▓▓▓▓▓▓│░░░░░░│ MO005 │ │
│ │──────────┴──────┴──────┴──────┴──────┴──────┤       │ │
│ │ ▓ 진행완료  ░ 계획        │ 오늘                    │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 납기 경보 ───────────────────────────────────────────────┐ │
│ │ 🔴 납기 지연: 3건 (MO003, MO008, MO015)                     │ │
│ │ 🟡 납기 임박 (D-2 이내): 5건                                │ │
│ │                                                             │ │
│ │ ⚠️ MO24020003: 납기 02-07, 진행률 0% → 긴급조치 필요        │ │
│ └───────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

### 3.5 ERP-PP-005: 생산실적 조회

#### 3.5.1 화면 목적
- 생산실적 집계 및 분석

#### 3.5.2 화면 레이아웃
```
┌─────────────────────────────────────────────────────────────────┐
│ 생산실적 조회                                    [엑셀] [인쇄]  │
├─────────────────────────────────────────────────────────────────┤
│ ┌─ 검색조건 ─────────────────────────────────────────────────┐ │
│ │ 실적기간: [2024-02-01] ~ [2024-02-29]                       │ │
│ │ 집계단위: [○일별 ●주별 ○월별]  라인: [전체      ▼]         │ │
│ │ 제품: [              ]                            [검색]   │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 실적 요약 ───────────────────────────────────────────────┐ │
│ │ 총 생산량: 485,000 EA  │  양품률: 97.8%  │  달성률: 94.2%  │ │
│ │ 계획: 515,000 EA      │  불량: 10,670 EA │  미달: 30,000 EA│ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 주별 생산실적 ───────────────────────────────────────────┐ │
│ │ 주차  │계획량 │생산량 │양품  │불량 │양품률│달성률│        │ │
│ │──────┼──────┼──────┼─────┼────┼─────┼─────┤        │ │
│ │ 1주차│125,000│118,500│116,000│2,500│97.9%│94.8%│        │ │
│ │ 2주차│130,000│127,000│124,300│2,700│97.9%│97.7%│        │ │
│ │ 3주차│140,000│135,200│132,000│3,200│97.6%│96.6%│        │ │
│ │ 4주차│120,000│104,300│102,000│2,300│97.8%│86.9%│ ⚠️    │ │
│ │──────┼──────┼──────┼─────┼────┼─────┼─────┤        │ │
│ │ 합계 │515,000│485,000│474,300│10,700│97.8%│94.2%│        │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 제품별 실적 ─────────────────────────────────────────────┐ │
│ │ 제품코드  │제품명      │계획  │양품  │불량│양품률│달성률│ │
│ │──────────┼───────────┼─────┼─────┼───┼─────┼─────│ │
│ │PCB-MB-001│스마트폰메인 │265K │258K │5.5K│97.9%│97.4%│ │
│ │PCB-PW-001│전원보드    │135K │132K │2.8K│97.9%│97.8%│ │
│ │PCB-LED-01│LED드라이버 │80K  │76K  │1.6K│97.9%│95.0%│ │
│ │ECU-001   │차량ECU     │35K  │33K  │0.8K│97.6%│94.3%│ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 실적 추이 (차트) ────────────────────────────────────────┐ │
│ │     150K ┤         ┌─┐                                     │ │
│ │     120K ┤  ┌─┐    │ │ ┌─┐                                │ │
│ │      90K ┤  │ │    │ │ │ │  ┌─┐                           │ │
│ │      60K ┤  │ │    │ │ │ │  │ │                           │ │
│ │      30K ┤  │ │    │ │ │ │  │ │                           │ │
│ │        0 ┼──┴─┴────┴─┴─┴─┴──┴─┴───                      │ │
│ │           1주    2주    3주    4주                          │ │
│ │        ■ 계획  □ 생산  ━ 양품률                            │ │
│ └───────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

### 3.6 ERP-PP-006: 작업지시 관리

#### 3.6.1 화면 목적
- MES 연동 작업지시 생성 및 관리

#### 3.6.2 화면 레이아웃
```
┌─────────────────────────────────────────────────────────────────┐
│ 작업지시 관리                          [신규] [MES전송] [회수]   │
├─────────────────────────────────────────────────────────────────┤
│ ┌─ 검색조건 ─────────────────────────────────────────────────┐ │
│ │ 지시일자: [2024-02-01] ~ [2024-02-29]  상태: [전체    ▼]  │ │
│ │ 라인: [전체      ▼]  오더번호: [              ]    [검색]  │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 작업지시 목록 ───────────────────────────────────────────┐ │
│ │ 지시번호    │오더번호  │제품      │라인 │지시량│MES상태│ERP상태│ │
│ │─────────────┼─────────┼─────────┼────┼─────┼─────┼─────│ │
│ │ WO24020001  │MO24020001│PCB-MB-001│L01 │5,000│완료  │실적확정│ │
│ │ WO24020002  │MO24020002│PCB-MB-001│L01 │5,000│생산중│전송완료│ │
│ │ WO24020003  │MO24020003│PCB-PW-001│L02 │3,000│대기  │전송완료│ │
│ │ WO24020004  │MO24020004│PCB-LED-01│L02 │2,000│-    │작성   │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 작업지시 상세 ───────────────────────────────────────────┐ │
│ │ 지시번호: [WO24020002   ]  MES상태: [생산중]               │ │
│ │ 제조오더: [MO24020002   ]  ERP상태: [전송완료]             │ │
│ │ 제품: [PCB-MB-001     ]  라인: [SMT-L01]                  │ │
│ │ 지시수량: [5,000       ]  완료수량: [3,200]                │ │
│ │ 계획시작: [2024-02-06 08:00]  계획종료: [2024-02-06 18:00] │ │
│ │                                                             │ │
│ │ ┌─ MES 실적 수신 ────────────────────────────────────────┐│ │
│ │ │ 시간    │양품  │불량│누적양품│누적불량│양품률│         ││ │
│ │ │────────┼─────┼───┼──────┼──────┼─────┤         ││ │
│ │ │ 08:00  │480  │12 │480   │12    │97.6%│         ││ │
│ │ │ 09:00  │495  │8  │975   │20    │98.0%│         ││ │
│ │ │ 10:00  │510  │5  │1,485 │25    │98.3%│         ││ │
│ │ │ ...    │     │   │      │      │     │         ││ │
│ │ │ 현재   │     │   │3,200 │58    │98.2%│         ││ │
│ │ └─────────────────────────────────────────────────────────┘│ │
│ │                                                             │ │
│ │ 최종 MES 수신: 2024-02-06 14:35:22                          │ │
│ │                              [실적확정] [회수] [재전송]     │ │
│ └───────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

#### 3.6.3 데이터 항목

**작업지시 (erp_work_order)**

| 필드명 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| wo_no | VARCHAR(12) | Y | 작업지시번호 (WO+년월+일련번호) |
| mo_no | VARCHAR(12) | Y | 제조오더번호 |
| item_code | VARCHAR(20) | Y | 제품코드 |
| line_code | VARCHAR(10) | Y | 라인코드 |
| order_qty | INT | Y | 지시수량 |
| good_qty | INT | N | 양품수량 |
| defect_qty | INT | N | 불량수량 |
| plan_start | TIMESTAMP | Y | 계획시작시간 |
| plan_end | TIMESTAMP | Y | 계획종료시간 |
| actual_start | TIMESTAMP | N | 실제시작시간 |
| actual_end | TIMESTAMP | N | 실제종료시간 |
| erp_status | VARCHAR(10) | Y | ERP상태 (작성/전송완료/실적확정/회수) |
| mes_status | VARCHAR(10) | N | MES상태 (대기/생산중/완료/중단) |

#### 3.6.4 비즈니스 로직
```
1. 작업지시 생성
   - 제조오더 발행 시 자동 생성
   - 일별 분할 또는 라인별 분할 가능

2. MES 전송
   - erp_mes_work_order_if 테이블에 등록
   - MES에서 폴링하여 작업지시 수신
   - ERP상태 → '전송완료'

3. 실적 수신
   - mes_erp_production_if 테이블에서 수신
   - 시간별 실적 누적
   - MES상태 실시간 반영

4. 실적 확정
   - 제조오더에 실적 반영
   - 완제품 재고 입고
   - 자재 소비 확정
```

---

### 3.7 ERP-PP-007: 생산능력 분석

#### 3.7.1 화면 목적
- 설비/라인 생산능력 분석 및 부하 관리

#### 3.7.2 화면 레이아웃
```
┌─────────────────────────────────────────────────────────────────┐
│ 생산능력 분석                                    [엑셀] [인쇄]  │
├─────────────────────────────────────────────────────────────────┤
│ ┌─ 분석조건 ─────────────────────────────────────────────────┐ │
│ │ 분석기간: [2024-02-01] ~ [2024-02-29]                       │ │
│ │ 공장: [본사공장  ▼]  라인: [전체      ▼]          [분석]   │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 생산능력 요약 ───────────────────────────────────────────┐ │
│ │ 총 능력: 650,000 EA  │  계획부하: 515,000 EA  │  가동률: 79%│ │
│ │ 여유능력: 135,000 EA │  과부하 라인: 0개                    │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 라인별 능력 현황 ────────────────────────────────────────┐ │
│ │ 라인   │일능력│가동일│총능력 │계획량 │가동률│상태       │ │
│ │───────┼─────┼─────┼──────┼──────┼─────┼──────────│ │
│ │SMT-L01│5,000│22   │110,000│95,000 │86%  │정상       │ │
│ │SMT-L02│3,000│22   │66,000 │58,000 │88%  │정상       │ │
│ │SMT-L03│4,000│22   │88,000 │82,000 │93%  │주의 🟡    │ │
│ │ASSY-01│2,500│22   │55,000 │45,000 │82%  │정상       │ │
│ │THT-L01│1,500│22   │33,000 │28,000 │85%  │정상       │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 일별 부하 현황 (SMT-L01) ────────────────────────────────┐ │
│ │ 100%┤████████████████████████████████████░░░░░░░░         │ │
│ │  80%┤────────────────────────────────────────────         │ │
│ │  60%┤                                                      │ │
│ │  40%┤                                                      │ │
│ │  20%┤                                                      │ │
│ │   0%┼─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─        │ │
│ │     01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 ... 28 29 │ │
│ └───────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

### 3.8 ERP-PP-008: 생산 KPI

#### 3.8.1 화면 목적
- 생산성 지표 대시보드

#### 3.8.2 화면 레이아웃
```
┌─────────────────────────────────────────────────────────────────┐
│ 생산 KPI 대시보드                                [새로고침]      │
├─────────────────────────────────────────────────────────────────┤
│ ┌─ 기간선택 ─────────────────────────────────────────────────┐ │
│ │ [○일간 ●주간 ○월간 ○분기]  기준일: [2024-02-06]           │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 핵심 KPI ─────────────────────────────────────────────────┐ │
│ │ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐    │ │
│ │ │ 생산달성률 │ │ 양품률    │ │ OEE       │ │ 납기준수율│    │ │
│ │ │   94.2%   │ │   97.8%   │ │   82.5%   │ │   95.3%   │    │ │
│ │ │  ▲ 2.1%  │ │  ▼ 0.3%  │ │  ▲ 1.5%  │ │  ▲ 0.5%  │    │ │
│ │ │ (전주대비)│ │ (전주대비)│ │ (전주대비)│ │ (전주대비)│    │ │
│ │ └───────────┘ └───────────┘ └───────────┘ └───────────┘    │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 라인별 OEE ──────────────────────────────────────────────┐ │
│ │ 라인   │가동률│성능률│품질률│OEE  │전주 │상태    │        │ │
│ │───────┼─────┼─────┼─────┼────┼────┼───────│        │ │
│ │SMT-L01│92%  │88%  │98%  │79% │77% │양호 🟢│        │ │
│ │SMT-L02│89%  │90%  │97%  │78% │80% │주의 🟡│        │ │
│ │SMT-L03│85%  │85%  │98%  │71% │75% │경고 🔴│        │ │
│ │ASSY-01│95%  │92%  │99%  │87% │85% │우수 🟢│        │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 불량 TOP 5 ──────────────────────────────────────────────┐ │
│ │ 순위│불량유형  │발생건수│비율  │주요원인          │       │ │
│ │────┼─────────┼──────┼─────┼────────────────│       │ │
│ │ 1  │솔더브릿지│325   │30.5%│인쇄두께 불균일   │       │ │
│ │ 2  │부품누락 │218   │20.4%│피더 이상         │       │ │
│ │ 3  │냉납     │156   │14.6%│리플로우 온도     │       │ │
│ │ 4  │틸트     │142   │13.3%│마운터 압력       │       │ │
│ │ 5  │쇼트     │98    │9.2% │솔더량 과다       │       │ │
│ └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─ 주간 생산 추이 ──────────────────────────────────────────┐ │
│ │     100%┤      ━━━━━━━━━━━━━━━━━━━━ 양품률              │ │
│ │      80%┤  ▓▓▓▓│▓▓▓▓│▓▓▓▓│▓▓▓▓│▓▓▓▓│                  │ │
│ │      60%┤  │   │    │    │    │    │                  │ │
│ │      40%┤  │   │    │    │    │    │                  │ │
│ │      20%┤  │   │    │    │    │    │                  │ │
│ │       0%┼──┴───┴────┴────┴────┴────┴──                │ │
│ │          월   화   수   목   금                          │ │
│ └───────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 테이블 설계

### 4.1 MPS (erp_mps_header / erp_mps_detail)
```sql
CREATE TABLE erp_mps_header (
    mps_no VARCHAR(12) PRIMARY KEY,
    plan_year INT NOT NULL,
    plan_month INT NOT NULL,
    plant_code VARCHAR(10) NOT NULL,
    status VARCHAR(10) DEFAULT '작성',
    total_qty INT DEFAULT 0,
    working_days INT,
    created_by VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    confirmed_at TIMESTAMP,
    confirmed_by VARCHAR(50)
);

CREATE TABLE erp_mps_detail (
    mps_no VARCHAR(12) NOT NULL,
    item_code VARCHAR(20) NOT NULL,
    week_no INT NOT NULL,
    plan_qty INT NOT NULL,
    demand_qty INT,
    stock_qty INT,
    PRIMARY KEY (mps_no, item_code, week_no),
    FOREIGN KEY (mps_no) REFERENCES erp_mps_header(mps_no),
    FOREIGN KEY (item_code) REFERENCES erp_item_master(item_code)
);
```

### 4.2 제조오더 (erp_manufacturing_order)
```sql
CREATE TABLE erp_manufacturing_order (
    mo_no VARCHAR(12) PRIMARY KEY,
    item_code VARCHAR(20) NOT NULL,
    plan_qty INT NOT NULL,
    good_qty INT DEFAULT 0,
    defect_qty INT DEFAULT 0,
    plan_date DATE NOT NULL,
    due_date DATE NOT NULL,
    plant_code VARCHAR(10) NOT NULL,
    line_code VARCHAR(10) NOT NULL,
    status VARCHAR(10) DEFAULT '작성',
    mps_no VARCHAR(12),
    so_no VARCHAR(12),
    bom_version VARCHAR(10),
    routing_version VARCHAR(10),
    issued_at TIMESTAMP,
    issued_by VARCHAR(50),
    completed_at TIMESTAMP,
    created_by VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (item_code) REFERENCES erp_item_master(item_code)
);
```

### 4.3 작업지시 (erp_work_order)
```sql
CREATE TABLE erp_work_order (
    wo_no VARCHAR(12) PRIMARY KEY,
    mo_no VARCHAR(12) NOT NULL,
    item_code VARCHAR(20) NOT NULL,
    line_code VARCHAR(10) NOT NULL,
    order_qty INT NOT NULL,
    good_qty INT DEFAULT 0,
    defect_qty INT DEFAULT 0,
    plan_start TIMESTAMP NOT NULL,
    plan_end TIMESTAMP NOT NULL,
    actual_start TIMESTAMP,
    actual_end TIMESTAMP,
    erp_status VARCHAR(10) DEFAULT '작성',
    mes_status VARCHAR(10),
    last_sync_at TIMESTAMP,
    created_by VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (mo_no) REFERENCES erp_manufacturing_order(mo_no),
    FOREIGN KEY (item_code) REFERENCES erp_item_master(item_code)
);
```

### 4.4 MRP 결과 (erp_mrp_result)
```sql
CREATE TABLE erp_mrp_result (
    mrp_run_id VARCHAR(20) NOT NULL,
    run_date TIMESTAMP NOT NULL,
    mps_no VARCHAR(12) NOT NULL,
    item_code VARCHAR(20) NOT NULL,
    gross_req INT NOT NULL,
    on_hand INT NOT NULL,
    on_order INT NOT NULL,
    net_req INT NOT NULL,
    planned_order INT NOT NULL,
    order_date DATE,
    due_date DATE,
    PRIMARY KEY (mrp_run_id, item_code),
    FOREIGN KEY (item_code) REFERENCES erp_item_master(item_code)
);
```

---

## 5. API 설계

### 5.1 MPS API
```
POST   /api/erp/mps                       MPS 등록
GET    /api/erp/mps                       MPS 목록 조회
GET    /api/erp/mps/{mps_no}              MPS 상세 조회
PUT    /api/erp/mps/{mps_no}              MPS 수정
POST   /api/erp/mps/{mps_no}/confirm      MPS 확정
```

### 5.2 MRP API
```
POST   /api/erp/mrp/run                   MRP 실행
GET    /api/erp/mrp/{run_id}              MRP 결과 조회
GET    /api/erp/mrp/{run_id}/shortage     부족품목 조회
POST   /api/erp/mrp/{run_id}/create-pr    구매요청 생성
```

### 5.3 제조오더 API
```
POST   /api/erp/manufacturing-order       제조오더 등록
GET    /api/erp/manufacturing-order       제조오더 목록 조회
GET    /api/erp/manufacturing-order/{mo_no}  제조오더 상세 조회
PUT    /api/erp/manufacturing-order/{mo_no}  제조오더 수정
POST   /api/erp/manufacturing-order/{mo_no}/issue  발행
POST   /api/erp/manufacturing-order/{mo_no}/complete  완료
DELETE /api/erp/manufacturing-order/{mo_no}  취소
```

### 5.4 작업지시 API
```
POST   /api/erp/work-order                작업지시 등록
GET    /api/erp/work-order                작업지시 목록 조회
POST   /api/erp/work-order/{wo_no}/send   MES 전송
POST   /api/erp/work-order/{wo_no}/recall 회수
POST   /api/erp/work-order/{wo_no}/confirm 실적 확정
GET    /api/erp/work-order/status         작업지시 현황
```

### 5.5 분석 API
```
GET    /api/erp/production/result         생산실적 조회
GET    /api/erp/production/capacity       생산능력 분석
GET    /api/erp/production/kpi            생산 KPI 조회
```

---

## 6. MES 연동

### 6.1 작업지시 전송 (ERP → MES)
```
작업지시 전송 시:
→ erp_mes_work_order_if 테이블에 등록

데이터 구조:
- wo_no: 작업지시번호
- item_code: 제품코드
- line_code: 라인코드
- order_qty: 지시수량
- plan_start/end: 계획시간
- bom_data: BOM JSON (자재 목록)
- routing_data: Routing JSON (공정 목록)
```

### 6.2 생산실적 수신 (MES → ERP)
```
MES 생산완료 시:
→ mes_erp_production_if 테이블에서 수신

데이터 구조:
- wo_no: 작업지시번호
- good_qty: 양품수량
- defect_qty: 불량수량
- actual_start/end: 실제 작업시간
- defect_detail: 불량 상세 JSON
```

### 6.3 자재소비 연동
```
MES 자재투입 시:
→ mes_erp_goods_movement_if 테이블에서 수신

movement_type: 'CONSUMPTION'
- wo_no: 작업지시번호
- item_code: 자재코드
- qty: 소비수량
- lot_no: LOT번호
```

---

## 7. 초기 데이터

### 7.1 생산상태 코드
| 코드 | 설명 |
|------|------|
| DRAFT | 작성 |
| ISSUED | 발행 |
| IN_PROGRESS | 진행중 |
| COMPLETED | 완료 |
| CANCELLED | 취소 |

### 7.2 MES 상태 코드
| 코드 | 설명 |
|------|------|
| WAITING | 대기 |
| RUNNING | 생산중 |
| PAUSED | 일시중지 |
| COMPLETED | 완료 |
| STOPPED | 중단 |
